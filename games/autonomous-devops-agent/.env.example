# Runtime mode: dry-run (default) or live
AGENT_MODE=live

# Adapter server settings (used by `npm run adapter`)
ADAPTER_HOST=127.0.0.1
ADAPTER_PORT=8790
# If true, POST /runs/* routes queue work and return 202 instead of running inline
ADAPTER_ASYNC_QUEUE=true
# Adapter API auth: none (default) or api-key
ADAPTER_AUTH_MODE=none
# Keep /health unauthenticated even when ADAPTER_AUTH_MODE=api-key
ADAPTER_ALLOW_PUBLIC_HEALTH=true
# Simple single-key option (admin role)
# ADAPTER_API_KEY=replace-me
# Optional role-specific keys
# ADAPTER_ADMIN_API_KEY=replace-me
# ADAPTER_OPERATOR_API_KEY=replace-me
# ADAPTER_APPROVER_API_KEY=replace-me
# ADAPTER_VIEWER_API_KEY=replace-me
# Optional compact map: id:key:roles where roles are pipe-delimited
# ADAPTER_AUTH_KEYS=ops:replace-me:operator|viewer,approver:replace-me:approver|viewer
# Optional JSON map:
# ADAPTER_AUTH_KEYS_JSON=[{"id":"ops","key":"replace-me","roles":["operator","viewer"]},{"id":"approver","key":"replace-me","roles":["approver","viewer"]}]

# Shared defaults used when upstream systems do not provide repo/branch metadata
DEFAULT_REPO=acme/platform-service
DEFAULT_BRANCH=main

# LLM provider settings (oss/openai/anthropic)
LLM_PROVIDER=openai
LLM_API_KEY=replace-me
LLM_MODEL=gpt-4o-mini

# OAuth token store used by `auth github` and `auth jira` chat commands
OAUTH_TOKEN_STORE_PATH=.agent/oauth-tokens.json

# State backend: file (default) or postgres
DATASTORE_DRIVER=file
# Required when DATASTORE_DRIVER=postgres
# DATABASE_URL=postgres://localhost:5432/autonomous_devops
DATABASE_SCHEMA=public

# Durable queue settings (used by `npm run worker` and adapter queue endpoints)
QUEUE_STORE_PATH=.agent/run-queue.json
QUEUE_POLL_INTERVAL_MS=2000
QUEUE_MAX_ATTEMPTS=3
QUEUE_INITIAL_BACKOFF_MS=2000
QUEUE_MAX_BACKOFF_MS=60000
# Worker lease/heartbeat/timeout/reaper controls
QUEUE_LEASE_MS=30000
QUEUE_HEARTBEAT_INTERVAL_MS=10000
# Set to 0 to disable run timeout enforcement
QUEUE_RUN_TIMEOUT_MS=1800000
QUEUE_REAP_INTERVAL_MS=15000

# Deployment policy gate:
# - auto: deploy to prod automatically when scan/tests pass
# - approval: stop before prod and require manual approval
DEPLOYMENT_POLICY_MODE=approval
APPROVAL_STORE_PATH=.agent/approvals.json

# Schedule runner settings (`npm run scheduler`)
SCHEDULE_STORE_PATH=.agent/schedules.json
SCHEDULE_POLL_INTERVAL_MS=30000

# GitHub OAuth app settings
GITHUB_OAUTH_CLIENT_ID=replace-me
GITHUB_OAUTH_CLIENT_SECRET=replace-me
GITHUB_OAUTH_REDIRECT_URI=http://localhost:8787/callback
GITHUB_OAUTH_SCOPES=repo,read:user

# Jira (Atlassian) OAuth app settings
JIRA_OAUTH_CLIENT_ID=replace-me
JIRA_OAUTH_CLIENT_SECRET=replace-me
JIRA_OAUTH_REDIRECT_URI=http://localhost:8787/callback
JIRA_OAUTH_SCOPES=read:jira-work,write:jira-work,offline_access,read:me
JIRA_OAUTH_AUDIENCE=api.atlassian.com

# Jira Cloud API
# If you use OAuth tokens, JIRA_BEARER_TOKEN can remain empty
JIRA_BASE_URL=https://your-company.atlassian.net
# Optional static auth fallback (when not using OAuth)
# JIRA_EMAIL=you@company.com
# JIRA_API_TOKEN=replace-me
# JIRA_BEARER_TOKEN=replace-me

# GitHub API
GITHUB_BASE_URL=https://api.github.com
# If you use OAuth tokens, GITHUB_TOKEN can remain empty
# GITHUB_TOKEN=replace-me
GITHUB_BASE_BRANCH=main

# Harness pipeline endpoints (required when EXECUTOR_ENABLED=false)
HARNESS_API_KEY=replace-me
HARNESS_PUBLISH_URL=https://app.harness.io/gateway/pipeline/api/pipelines/custom/v1/publish
HARNESS_DEPLOY_URL=https://app.harness.io/gateway/pipeline/api/pipelines/custom/v1/deploy
HARNESS_SCAN_URL=https://app.harness.io/gateway/pipeline/api/pipelines/custom/v1/scan

# Local execution engine for build/test/deploy/validate (optional)
# When enabled, chat-triggered runs execute these commands in EXECUTOR_WORKDIR.
EXECUTOR_ENABLED=true
EXECUTOR_WORKDIR=/absolute/path/to/your/service-repo
BUILD_COMMAND=npm run build
TEST_COMMAND=npm test
DEPLOY_DEV_COMMAND=kubectl apply -f k8s/overlays/dev
DEPLOY_PROD_COMMAND=kubectl apply -f k8s/overlays/prod
VALIDATE_DEV_COMMAND=kubectl rollout status deployment/${K8S_DEPLOYMENT:-app} -n ${K8S_DEV_NAMESPACE:-dev} --timeout=180s
VALIDATE_PROD_COMMAND=kubectl rollout status deployment/${K8S_DEPLOYMENT:-app} -n ${K8S_PROD_NAMESPACE:-prod} --timeout=180s
K8S_DEPLOYMENT=platform-service
K8S_DEV_NAMESPACE=dev
K8S_PROD_NAMESPACE=prod

# Multi-target execution controls
# Clone source into isolated run workspace before build/test/deploy
EXECUTOR_CLONE_SOURCE=false
EXECUTOR_SOURCE_ROOT=.agent/workspaces
# Optional explicit source repo URL template (supports ${AGENT_REPO}, ${AGENT_BRANCH}, ${AGENT_RUN_ID})
# EXECUTOR_SOURCE_REPO_URL=https://github.com/${AGENT_REPO}.git
# Optional source branch/ref override
# EXECUTOR_SOURCE_REPO_REF=main
# Optional clone token override (defaults to GITHUB_TOKEN when present)
# EXECUTOR_SOURCE_REPO_TOKEN=replace-me

# Optional separate deployment config repository
EXECUTOR_CLONE_DEPLOY_CONFIG=false
# EXECUTOR_DEPLOY_CONFIG_REPO_URL=https://github.com/acme/platform-deploy.git
# EXECUTOR_DEPLOY_CONFIG_REPO_REF=main
# Relative path inside source/config repo containing deploy manifests/scripts
EXECUTOR_DEPLOY_CONFIG_PATH=.

# Optional binary acquisition
# EXECUTOR_BINARY_URL=https://artifacts.example.com/${AGENT_REPO}/${AGENT_BRANCH}/app.zip
# EXECUTOR_BINARY_DOWNLOAD_COMMAND=curl -fsSL "$EXECUTOR_BINARY_URL" -o "$BINARY_OUTPUT_PATH"
# EXECUTOR_BINARY_SHA256=replace-with-expected-sha256

# Explicit target list (JSON array). Leave empty to use legacy DEPLOY_* commands.
# When EXECUTOR_AUTO_DETECT_TARGETS=true, target type is inferred from repo files if JSON is empty.
EXECUTOR_AUTO_DETECT_TARGETS=true
# EXECUTOR_DEPLOYMENT_TARGETS_JSON=[{"name":"dev-k8s","type":"kubernetes","environments":["dev"],"manifestPath":"k8s/overlays/dev","namespace":"dev"},{"name":"prod-helm","type":"helm","environments":["prod"],"chartPath":"helm","valuesFile":"helm/values.prod.yaml","releaseName":"platform-service","namespace":"prod"}]

# Provider/tool preflight checks:
# - EXECUTOR_PREFLIGHT_ENABLED: validates required CLIs/auth before deployment stages
# - EXECUTOR_PREFLIGHT_AUTH_CHECKS: includes cloud auth and kube context checks
EXECUTOR_PREFLIGHT_ENABLED=true
EXECUTOR_PREFLIGHT_AUTH_CHECKS=true

# ServiceNow (optional but recommended)
SERVICENOW_BASE_URL=https://your-instance.service-now.com
SERVICENOW_TABLE=incident
SERVICENOW_USERNAME=agent-user
SERVICENOW_PASSWORD=replace-me
# Optional bearer token auth
# SERVICENOW_BEARER_TOKEN=replace-me
# Optional default incident/change number to update after each run
SERVICENOW_RECORD_ID=INC0012345
